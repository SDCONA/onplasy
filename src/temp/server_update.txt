app.get('/make-server-5dec7914/reviews/check', async (c) => {
  try {
    const user = await getAuthUser(c.req.raw);
    if (!user) return c.json({ error: 'Unauthorized' }, 401);
    
    const revieweeId = c.req.query('reviewee_id');
    
    // Check if current user has EVER reviewed this user (regardless of conversation)
    const { data } = await supabase
      .from('reviews')
      .select('id')
      .eq('reviewer_id', user.id)
      .eq('reviewee_id', revieweeId)
      .limit(1);
    
    return c.json({ hasReviewed: data && data.length > 0 });
  } catch (error) {
    return c.json({ hasReviewed: false });
  }
});